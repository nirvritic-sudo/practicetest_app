<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Physics Practice Test</title>
   <style>
       body {
           font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
           background-color: #f4f4f9;
           margin: 0;
           padding: 20px;
           color: #333;
       }


       .container {
           max-width: 800px;
           margin: 0 auto;
       }


       /* --- Header & Scoreboard --- */
       .header-box { text-align: center; margin-bottom: 30px; }


       .score-board {
           display: none;
           background-color: #d4edda; color: #155724;
           border: 2px solid #c3e6cb; padding: 20px;
           border-radius: 10px; margin-bottom: 20px;
           font-size: 1.5rem; font-weight: bold; text-align: center;
       }


       /* --- Buttons --- */
       .btn-container { display: flex; justify-content: space-between; margin: 20px 0; }


       .btn {
           padding: 12px 24px; font-size: 1rem; font-weight: 600;
           border: none; border-radius: 6px; cursor: pointer; transition: opacity 0.2s;
       }
       .btn:hover { opacity: 0.9; }
       .btn-save { background-color: #ffc107; color: #333; }
       .btn-submit { background-color: #28a745; color: white; }


       /* --- Question Card --- */
       .question-card {
           background: white; border-radius: 12px; padding: 25px;
           margin-bottom: 25px; box-shadow: 0 4px 6px rgba(0,0,0,0.05);
           border-left: 5px solid #007bff;
       }


       .question-text { font-size: 1.1rem; margin-bottom: 15px; line-height: 1.5; }


       .options-list { list-style: none; padding: 0; }


       .option-item {
           background-color: #f8f9fa; border: 1px solid #e9ecef;
           border-radius: 8px; margin-bottom: 10px; padding: 12px 15px;
           cursor: pointer; transition: background-color 0.2s;
           display: flex; align-items: center;
       }
       .option-item:hover { background-color: #e2e6ea; }
       .option-item input[type="radio"] { margin-right: 15px; transform: scale(1.3); cursor: pointer; }


       /* --- Hint & Feedback Styles --- */
       .btn-hint {
           background-color: #17a2b8; color: white; border: none;
           padding: 5px 10px; border-radius: 4px; font-size: 0.85rem;
           cursor: pointer; margin-top: 10px;
       }
       .btn-hint:hover { background-color: #138496; }


       .hint-text {
           margin-top: 10px; padding: 10px; background-color: #e2f6fa;
           border-left: 3px solid #17a2b8; font-size: 0.95rem; color: #0c5460;
           display: none; /* Hidden by default */
       }


       .feedback-text { margin-top: 10px; font-weight: bold; display: none; }
       .correct-box { border: 2px solid #28a745; background-color: #d4edda; }
       .incorrect-box { border: 2px solid #dc3545; background-color: #f8d7da; }
   </style>
</head>
<body>


<div class="container">
   <div class="header-box">
       <h1>Physics Practice Test</h1>
       <p>Instructions: +4 for correct answers, -1 for incorrect answers.</p>
   </div>


   <div id="scoreDisplay" class="score-board">
       Score: <span id="scoreVal">0</span> / <span id="totalVal">0</span>
   </div>


   <div class="btn-container">
       <button class="btn btn-save" onclick="saveProgress()">Save Progress</button>
       <button class="btn btn-submit" onclick="submitTest()">Submit Test</button>
   </div>


   <form id="quizForm">
       {% if questions|length == 0 %}
           <div class="question-card" style="text-align:center; color: red;">
               <h3>No questions generated.</h3>
               <p>Please check your API key or try selecting different topics.</p>
           </div>
       {% endif %}


       {% for q in questions %}
       {# FIXED: Capture outer loop index to ensure grouping #}
       {% set q_index = loop.index %}


       <div class="question-card" id="card_{{ q_index }}" data-correct="{{ q.correct_answer }}">


           <div class="question-text">
               <strong>Q{{ q_index }}.</strong> {{ q.question }}
           </div>


           <ul class="options-list">
               {% set letters = ['A', 'B', 'C', 'D'] %}
               {% for option_text in q.options %}
                   {% set letter = letters[loop.index0] %}
                   {# FIXED: Use q_index for ID and NAME to keep radio buttons grouped per question #}
                   <label class="option-item" id="opt_{{ q_index }}_{{ letter }}">
                       <input type="radio" name="q{{ q_index }}" value="{{ letter }}">
                       <span>{{ option_text }}</span>
                   </label>
               {% endfor %}
           </ul>


           <button type="button" class="btn-hint" onclick="toggleHint('hint_{{ q_index }}')">Show Hint üí°</button>
           <div class="hint-text" id="hint_{{ q_index }}">
               <strong>Hint:</strong> {{ q.Hint }}
           </div>


           <div class="feedback-text" id="feedback_{{ q_index }}"></div>
       </div>
       {% endfor %}
   </form>


   <div class="btn-container">
       <button class="btn btn-save" onclick="saveProgress()">Save Progress</button>
       <button class="btn btn-submit" onclick="submitTest()">Submit Test</button>
   </div>
</div>


<script>
   // Toggle Hint Visibility
   function toggleHint(elementId) {
       var hintDiv = document.getElementById(elementId);
       if (hintDiv.style.display === "none" || hintDiv.style.display === "") {
           hintDiv.style.display = "block";
       } else {
           hintDiv.style.display = "none";
       }
   }


   function saveProgress() {
       alert("Progress saved locally!");
   }


   function submitTest() {
       let score = 0;
       let correctPoints = 4;
       let incorrectPoints = -1;


       const cards = document.querySelectorAll('.question-card');
       const totalMaxScore = cards.length * correctPoints;


       cards.forEach((card, index) => {
           // 1. Get the raw string from Python/Jinja
           const rawCorrect = card.getAttribute('data-correct').trim();
           let correctLetter = "";


           // 2. Robust Regex to find the letter A, B, C, or D
           const match = rawCorrect.match(/(?:^|[\s*\(])([A-D])(?:[\s*\).:]|$)/i);


           if (match && match[1]) {
               correctLetter = match[1].toUpperCase();
           } else {
               console.warn(`Could not extract letter from: ${rawCorrect}`);
           }


           // 3. Find what the user checked
           const selectedInput = card.querySelector('input[type="radio"]:checked');
           const feedbackDiv = card.querySelector('.feedback-text');
           const hintDiv = card.querySelector('.hint-text');


           // Force show hint and feedback
           hintDiv.style.display = "block";
           feedbackDiv.style.display = "block";


           // Reset visual styles
           card.querySelectorAll('.option-item').forEach(opt => {
               opt.classList.remove('correct-box', 'incorrect-box');
           });


           if (selectedInput) {
               const userChoice = selectedInput.value;


               if (userChoice === correctLetter) {
                   // --- User is CORRECT ---
                   score += correctPoints;
                   feedbackDiv.innerHTML = "‚úÖ Correct! (+4)";
                   feedbackDiv.style.color = "#155724";
                   selectedInput.closest('.option-item').classList.add('correct-box');
               } else {
                   // --- User is INCORRECT ---
                   score += incorrectPoints;
                   feedbackDiv.innerHTML = `‚ùå Incorrect (-1). Correct Answer: <strong>${correctLetter}</strong>`;
                   feedbackDiv.style.color = "#721c24";
                   selectedInput.closest('.option-item').classList.add('incorrect-box');


                   // Highlight the actual correct answer in Green
                   if(correctLetter) {
                       const correctOpt = card.querySelector(`input[value="${correctLetter}"]`);
                       if(correctOpt) correctOpt.closest('.option-item').classList.add('correct-box');
                   }
               }
           } else {
               // --- User skipped the question ---
               feedbackDiv.innerHTML = `‚ö†Ô∏è Unattempted (0). Correct Answer: <strong>${correctLetter}</strong>`;
               feedbackDiv.style.color = "#856404";


               // Highlight the actual correct answer in Green
               if(correctLetter) {
                   const correctOpt = card.querySelector(`input[value="${correctLetter}"]`);
                   if(correctOpt) correctOpt.closest('.option-item').classList.add('correct-box');
               }
           }
       });


       // 4. Update Score Board
       const scoreDisplay = document.getElementById('scoreDisplay');
       document.getElementById('scoreVal').innerText = score;
       document.getElementById('totalVal').innerText = totalMaxScore;
       scoreDisplay.style.display = 'block';


       // Scroll to top
       window.scrollTo({ top: 0, behavior: 'smooth' });
   }
</script>


</body>
</html>